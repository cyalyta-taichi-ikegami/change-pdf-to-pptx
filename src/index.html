<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF to Slides | Premium Converter</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Outfit:wght@400;700&display=swap"
    rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
  </script>
  <style>
    :root {
      --primary: #00d2ff;
      --secondary: #3a7bd5;
      --bg-dark: #0f172a;
      --card-glass: rgba(255, 255, 255, 0.05);
      --text-main: #f8fafc;
      --text-dim: #94a3b8;
      --accent: #22d3ee;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: radial-gradient(circle at top right, #1e293b, var(--bg-dark));
      color: var(--text-main);
      min-height: 100vh;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow-x: hidden;
    }

    .container {
      width: 90%;
      max-width: 650px;
      padding: 40px;
      background: var(--card-glass);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 24px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      text-align: center;
      animation: fadeIn 0.8s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1 {
      font-family: 'Outfit', sans-serif;
      font-size: 2.5rem;
      margin-bottom: 8px;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    p.subtitle {
      color: var(--text-dim);
      margin-bottom: 32px;
      font-weight: 300;
    }

    .input-group {
      text-align: left;
      margin-bottom: 24px;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 0.9rem;
      color: var(--accent);
      font-weight: 600;
    }

    .input-group input[type="text"] {
      width: 100%;
      padding: 12px 16px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: white;
      box-sizing: border-box;
      transition: all 0.3s;
    }

    .input-group input[type="text"]:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 10px rgba(0, 210, 255, 0.3);
    }

    .upload-area {
      border: 2px dashed rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      padding: 40px 20px;
      cursor: pointer;
      transition: all 0.3s;
      background: rgba(255, 255, 255, 0.02);
      margin-bottom: 24px;
      position: relative;
    }

    .upload-area:hover,
    .upload-area.dragover {
      border-color: var(--primary);
      background: rgba(0, 210, 255, 0.05);
    }

    .upload-icon {
      font-size: 40px;
      margin-bottom: 12px;
      display: block;
    }

    #file-info {
      margin-top: 16px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      font-size: 0.85rem;
      display: none;
      text-align: left;
    }

    .btn-convert {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border: none;
      border-radius: 12px;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 10px 20px -5px rgba(58, 123, 213, 0.4);
    }

    .btn-convert:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 15px 25px -5px rgba(58, 123, 213, 0.5);
    }

    .btn-convert:active:not(:disabled) {
      transform: translateY(0);
    }

    .btn-convert:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: #475569;
    }

    /* Progress Bar */
    #progress-container {
      margin-top: 32px;
      display: none;
    }

    .progress-wrapper {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    #progress-bar {
      width: 0%;
      height: 100%;
      background: linear-gradient(to right, var(--primary), var(--accent));
      transition: width 0.3s ease;
    }

    #status-text {
      font-size: 0.85rem;
      color: var(--text-dim);
    }

    #result-link {
      margin-top: 24px;
      display: none;
      padding: 16px;
      background: rgba(34, 211, 238, 0.1);
      border: 1px solid var(--accent);
      border-radius: 12px;
    }

    #result-link a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
    }

    #result-link a:hover {
      text-decoration: underline;
    }

    input[type="file"] {
      display: none;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>PDF to Slides</h1>
    <p class="subtitle">PDFã‚’é«˜ç”»è³ªãªGoogleã‚¹ãƒ©ã‚¤ãƒ‰ã«ä¸€æ‹¬å¤‰æ›</p>

    <div class="input-group">
      <label for="folderUrl">ä¿å­˜å…ˆãƒ•ã‚©ãƒ«ãƒ€URL (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)</label>
      <input type="text" id="folderUrl" placeholder="https://drive.google.com/drive/folders/..." />
    </div>

    <label for="fileInput" class="upload-area" id="dropZone">
      <span class="upload-icon">ğŸ“„</span>
      <span id="upload-text">PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã€ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ</span>
      <input type="file" id="fileInput" accept=".pdf" onchange="handleFileSelect(this)" />
      <div id="file-info">
        <strong>ãƒ•ã‚¡ã‚¤ãƒ«å:</strong> <span id="info-name">-</span><br>
        <strong>ã‚µã‚¤ã‚º:</strong> <span id="info-size">-</span><br>
        <strong>ãƒšãƒ¼ã‚¸æ•°:</strong> <span id="info-pages">-</span>
      </div>
    </label>

    <button id="convertBtn" class="btn-convert" onclick="processPDF()" disabled>å¤‰æ›ã‚’é–‹å§‹ã™ã‚‹</button>

    <div id="progress-container">
      <div class="progress-wrapper">
        <div id="progress-bar"></div>
      </div>
      <div id="status-text">æº–å‚™ä¸­...</div>
    </div>

    <div id="result-link">
      ğŸ‰ å¤‰æ›ãŒå®Œäº†ã—ã¾ã—ãŸï¼<br><br>
      <a id="output-url" href="#" target="_blank">Googleã‚¹ãƒ©ã‚¤ãƒ‰ã‚’é–‹ã</a>
    </div>
  </div>

  <script>
    let selectedFile = null;
    let pdfPageCount = 0;

    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const convertBtn = document.getElementById('convertBtn');
    const fileInfo = document.getElementById('file-info');
    const statusText = document.getElementById('status-text');
    const progressBar = document.getElementById('progress-bar');
    const progressContainer = document.getElementById('progress-container');
    const resultLink = document.getElementById('result-link');

    // Drag & Drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, e => {
        e.preventDefault();
        e.stopPropagation();
      }, false);
    });

    ['dragenter', 'dragover'].forEach(eventName => {
      dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
    });

    dropZone.addEventListener('drop', e => {
      const dt = e.dataTransfer;
      const files = dt.files;
      if (files.length) {
        fileInput.files = files;
        handleFileSelect(fileInput);
      }
    });

    async function handleFileSelect(input) {
      if (!input.files.length) return;

      selectedFile = input.files[0];
      if (selectedFile.type !== 'application/pdf') {
        alert('PDFãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      // Show info
      document.getElementById('info-name').innerText = selectedFile.name;
      document.getElementById('info-size').innerText = (selectedFile.size / 1024 / 1024).toFixed(2) + ' MB';

      try {
        const arrayBuffer = await selectedFile.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        pdfPageCount = pdf.numPages;
        document.getElementById('info-pages').innerText = pdfPageCount + ' ãƒšãƒ¼ã‚¸';

        fileInfo.style.display = 'block';
        document.getElementById('upload-text').style.display = 'none';
        convertBtn.disabled = false;
        resultLink.style.display = 'none';
      } catch (err) {
        alert('PDFã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    }

    async function processPDF() {
      if (!selectedFile) return;

      convertBtn.disabled = true;
      progressContainer.style.display = 'block';
      resultLink.style.display = 'none';

      const folderUrl = document.getElementById('folderUrl').value;
      const arrayBuffer = await selectedFile.arrayBuffer();
      const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
      const images = [];

      for (let i = 1; i <= pdf.numPages; i++) {
        const percent = Math.round((i / pdf.numPages) * 70); // Up to 70% for image processing
        updateStatus(`ãƒšãƒ¼ã‚¸ã‚’å¤‰æ›ä¸­... (${i}/${pdf.numPages})`, percent);

        const page = await pdf.getPage(i);
        const viewport = page.getViewport({ scale: 2.5 }); // High quality
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = viewport.width;
        canvas.height = viewport.height;

        await page.render({ canvasContext: context, viewport }).promise;
        images.push(canvas.toDataURL('image/png'));
      }

      updateStatus("Googleã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ä½œæˆä¸­...", 80);

      google.script.run
        .withSuccessHandler(url => {
          updateStatus("å®Œäº†ï¼", 100);
          document.getElementById('output-url').href = url;
          resultLink.style.display = 'block';
          convertBtn.disabled = false;
          alert("Googleã‚¹ãƒ©ã‚¤ãƒ‰ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼");
        })
        .withFailureHandler(e => {
          updateStatus("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ", 0);
          alert("ã‚¨ãƒ©ãƒ¼: " + e);
          convertBtn.disabled = false;
        })
        .createPresentationFromImages(images, selectedFile.name, folderUrl);
    }

    function updateStatus(text, percent) {
      statusText.innerText = text;
      progressBar.style.width = percent + '%';
    }
  </script>
</body>

</html>